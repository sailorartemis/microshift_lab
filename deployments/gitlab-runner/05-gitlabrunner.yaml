iapiVersion: apps.gitlab.com/v1beta2
kind: Runner
metadata:
  name: small-infra-runner
  namespace: gitlab-runner
spec:
  gitlabUrl: "https://gitlab.com"
  token: gitlab-runner-secret
  buildImage: "registry.access.redhat.com/ubi9/ubi:9.6"

  tags: "kubernetes,infra,kaniko,k8s"
  runUntagged: false
  locked: false

  concurrent: 12

  config: runner-config

#  env: runner-proxy-env

  podSpec:
    - name: runner-resources
      patch: |
        containers:
        - name: runner
          resources:
            requests:
              cpu: "500m"
              memory: "1Gi"
            limits:
              cpu: "1"
              memory: "2Gi"
      patchType: strategic

    - name: request-concurrency
      patch: |
        containers:
        - name: runner
          env:
          - name: RUNNER_REQUEST_CONCURRENCY
            value: "4"
      patchType: strategic
